<!-- CSS -->
<style>
  .form-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background: white;
    border-radius: 24px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .form-step {
    display: none;
  }

  .form-step.active {
    display: block;
  }

  .progress-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    padding: 0 20px;
  }

  .step-indicator {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    color: #6b7280;
    position: relative;
  }

  .step-indicator.active {
    background: #2563EB;
    color: white;
  }

  .step-indicator.completed {
    background: #2563EB;
    color: white;
  }

  .step-line {
    flex: 1;
    height: 4px;
    background: #e5e7eb;
    margin: 16px 8px;
  }

  .step-line.active {
    background: #2563EB;
  }

  .form-option {
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .form-option:hover {
    border-color: #2563EB;
  }

  .form-option input[type="radio"] {
    margin-right: 10px;
  }

  .option-letter {
    width: 32px;
    height: 32px;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    color: #111827;
  }

  .form-input {
    width: 100%;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    margin-bottom: 16px;
  }

  .submit-button {
    width: 100%;
    padding: 14px;
    background: #2563EB;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .submit-button:hover {
    background: #1d4ed8;
  }

  .error-message {
    color: #ef4444;
    font-size: 14px;
    margin-top: 4px;
  }
</style>

<!-- HTML -->
<div class="form-container">
  <div class="progress-bar">
    <div class="step-indicator active">1</div>
    <div class="step-line"></div>
    <div class="step-indicator">2</div>
    <div class="step-line"></div>
    <div class="step-indicator">3</div>
    <div class="step-line"></div>
    <div class="step-indicator">4</div>
    <div class="step-line"></div>
    <div class="step-indicator">5</div>
  </div>

  <form id="energyForm">
    <!-- Step 1 -->
    <div class="form-step active" data-step="1">
      <h3>Seleccione el tipo de cliente:</h3>
      <label class="form-option">
        <div class="option-letter">A</div>
        <input type="radio" name="clientType" value="particular"> Particular
      </label>
      <label class="form-option">
        <div class="option-letter">B</div>
        <input type="radio" name="clientType" value="autonomo"> Autónomo / Pyme
      </label>
    </div>

    <!-- Step 2 -->
    <div class="form-step" data-step="2">
      <h3>¿Qué tipo de vivienda tienes?</h3>
      <label class="form-option">
        <div class="option-letter">A</div>
        <input type="radio" name="houseType" value="apartamento"> Apartamento o casa pequeña
      </label>
      <label class="form-option">
        <div class="option-letter">B</div>
        <input type="radio" name="houseType" value="casa"> Casa grande o chale
      </label>
      <label class="form-option">
        <div class="option-letter">C</div>
        <input type="radio" name="houseType" value="otro"> Otro tipo de vivienda
      </label>
    </div>

    <!-- Step 3 -->
    <div class="form-step" data-step="3">
      <h3>¿Cuál es tu compañía actual?</h3>
      <label class="form-option">
        <div class="option-letter">A</div>
        <input type="radio" name="currentCompany" value="gana"> Gana Energia
      </label>
      <label class="form-option">
        <div class="option-letter">B</div>
        <input type="radio" name="currentCompany" value="repsol"> Repsol
      </label>
      <label class="form-option">
        <div class="option-letter">C</div>
        <input type="radio" name="currentCompany" value="iberdrola"> Iberdrola
      </label>
      <label class="form-option">
        <div class="option-letter">D</div>
        <input type="radio" name="currentCompany" value="eniplenitude"> Eniplenitude
      </label>
      <label class="form-option">
        <div class="option-letter">E</div>
        <input type="radio" name="currentCompany" value="endesa"> Endesa
      </label>
      <label class="form-option">
        <div class="option-letter">F</div>
        <input type="radio" name="currentCompany" value="otro"> Otro/No lo sé
      </label>
    </div>

    <!-- Step 4 -->
    <div class="form-step" data-step="4">
      <h3>¿Cuál es el monto de tu factura mensual actual?</h3>
      <label class="form-option">
        <div class="option-letter">A</div>
        <input type="radio" name="monthlyBill" value="menos-50"> Menos de 50 € al mes
      </label>
      <label class="form-option">
        <div class="option-letter">B</div>
        <input type="radio" name="monthlyBill" value="50-100"> Entre 50 € y 100 € al mes
      </label>
      <label class="form-option">
        <div class="option-letter">C</div>
        <input type="radio" name="monthlyBill" value="100-150"> Entre 100 € y 150 € al mes
      </label>
      <label class="form-option">
        <div class="option-letter">D</div>
        <input type="radio" name="monthlyBill" value="mas-150"> Más de 150 € al mes
      </label>
      <label class="form-option">
        <div class="option-letter">E</div>
        <input type="radio" name="monthlyBill" value="no-se"> No lo sé
      </label>
    </div>

    <!-- Step 5 -->
    <div class="form-step" data-step="5">
      <h3>Información de contacto</h3>
      <input type="text" name="postalCode" class="form-input" placeholder="Código postal" required>
      <input type="text" name="city" class="form-input" placeholder="Ciudad" required>
      <input type="text" name="fullName" class="form-input" placeholder="Nombre completo" required>
      <input type="email" name="email" class="form-input" placeholder="Email" required>
      <input type="tel" name="phone" class="form-input" placeholder="+34XXXXXXXXX" required>
      
      <label style="display: block; margin-bottom: 20px;">
        <input type="checkbox" name="gdprConsent" required>
        Al hacer clic en «Enviar», confirmo que he leído y acepto las 
        <a href="https://comparadorluzgas.com/gaz-y-luz-condiciones-generales/" target="_blank">condiciones generales de uso</a>.
      </label>
      
      <button type="submit" class="submit-button">
        Enviar
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
          <path d="m12 5 7 7-7 7"></path>
        </svg>
      </button>
    </div>
  </form>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  let currentStep = 1;
  const form = document.getElementById('energyForm');
  const steps = document.querySelectorAll('.form-step');
  const indicators = document.querySelectorAll('.step-indicator');
  const stepLines = document.querySelectorAll('.step-line');

  // Fonction pour mettre à jour les indicateurs de progression
  function updateProgressBar(step) {
    indicators.forEach((indicator, index) => {
      if (index + 1 < step) {
        indicator.classList.add('completed');
        indicator.classList.remove('active');
      } else if (index + 1 === step) {
        indicator.classList.add('active');
        indicator.classList.remove('completed');
      } else {
        indicator.classList.remove('active', 'completed');
      }
    });

    stepLines.forEach((line, index) => {
      if (index + 1 < step) {
        line.classList.add('active');
      } else {
        line.classList.remove('active');
      }
    });
  }

  // Fonction pour afficher l'étape suivante
  function showStep(step) {
    steps.forEach(s => s.classList.remove('active'));
    const currentStepElement = document.querySelector(`[data-step="${step}"]`);
    if (currentStepElement) {
      currentStepElement.classList.add('active');
      updateProgressBar(step);
    }
  }

  // Gestionnaire pour les boutons radio
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      if (currentStep < 5) {
        currentStep++;
        showStep(currentStep);
      }
    });
  });

  // Validation du numéro de téléphone espagnol
  function validateSpanishPhone(phone) {
    const spanishPhoneRegex = /^\+34[0-9]{9}$/;
    return spanishPhoneRegex.test(phone);
  }

  // Validation du code postal espagnol
  function validateSpanishPostalCode(postalCode) {
    const spanishPostalCodeRegex = /^(?:0[1-9]|[1-4][0-9]|5[0-2])[0-9]{3}$/;
    return spanishPostalCodeRegex.test(postalCode);
  }

  // Gestionnaire de soumission du formulaire
  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(form);
    const phone = formData.get('phone');
    const postalCode = formData.get('postalCode');

    // Validation du téléphone
    if (!validateSpanishPhone(phone)) {
      alert('Por favor, introduzca un número de teléfono español válido (+34XXXXXXXXX)');
      return;
    }

    // Validation du code postal
    if (!validateSpanishPostalCode(postalCode)) {
      alert('Por favor, introduzca un código postal español válido (5 dígitos)');
      return;
    }

    // Préparation des données pour Leadbyte
    const leadbyteData = new FormData();
    leadbyteData.append('returnjson', 'yes');
    leadbyteData.append('campid', 'GAZELEC-ESPAGNE');
    leadbyteData.append('typeform', formData.get('houseType'));
    leadbyteData.append('particulier', formData.get('clientType'));
    leadbyteData.append('fournisseur_actuel', formData.get('currentCompany'));
    leadbyteData.append('postcode', formData.get('postalCode'));
    leadbyteData.append('towncity', formData.get('city'));

    const fullName = formData.get('fullName');
    const [firstname = "", lastname = ""] = fullName.split(" ");
    leadbyteData.append('firstname', firstname);
    leadbyteData.append('lastname', lastname);

    leadbyteData.append('email', formData.get('email'));
    leadbyteData.append('phone1', formData.get('phone'));
    leadbyteData.append('source', window.location.href);
    leadbyteData.append('type_energie', 'electricite');
    leadbyteData.append('objectif_recherche', 'economiser');
    leadbyteData.append('b2b', 'no');

    try {
      const response = await fetch('https://leadstudio.leadbyte.co.uk/api/submit.php', {
        method: 'POST',
        body: leadbyteData
      });

      if (response.ok) {
        // Redirection vers la page de remerciement
        window.location.href = 'https://tucomparadorenergetico.com/energia-gracias-1/';
      } else {
        alert('Ha ocurrido un error. Por favor, inténtelo de nuevo más tarde.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Ha ocurrido un error. Por favor, inténtelo de nuevo más tarde.');
    }
  });
});
</script>